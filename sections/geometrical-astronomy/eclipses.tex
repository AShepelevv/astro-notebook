\subsection{Затмения}
\term{Тенью} называется область, откуда не виден рассматриваемый источник света. \term{Полутенью}~--- область, откуда источник света виден частично, из чего следует, что понятие \imp{полутени} не применимо к точечным источникам.

Рассмотрим тень, создаваемую сферическим объектом~--- ширмой, откуда не виден сферический источник света большего, чем ширма, размера, \lookPicRef{pic:shadow-length}. Границу тени формируют общие касательные в точках, лежащих по одну сторону от прямой, проходящей через центры источника и ширмы. Легко понять, что в этом случае тень имеет конечные размеры. Определим, чему равна длина тени $x$~--- расстояние от её вершины до центра ширмы.

\begin{figure}[h!]
    \centering
    \begin{tikzpicture}
        \tkzDefPoint(0, 0){X}
        \tkzDefPoint(-3.5,0){C1}
        \tkzDefShiftPoint[C1](0.5,0){R1}
        
        \def\k{2.5}
        \tkzDefPointBy[homothety=center X  ratio \k](C1) \tkzGetPoint{C2}
        \tkzDefPointBy[homothety=center X  ratio \k](R1) \tkzGetPoint{R2}
        
        \tkzDefLine[tangent from = X](C1,R1) \tkzGetPoints{A1}{B1}
        \tkzDefLine[tangent from = X](C2,R2) \tkzGetPoints{A2}{B2}
        
        \tkzDrawPolygon[fill=gray!40,draw=none](X,A1,B1)
        
        \tkzDrawCircles[fill=white, thick, draw=black](C1,R1 C2,R2)
        \tkzDrawSegments(X,A2 X,B2 X,C2 C2,A2 C2,B2 C1,A1 C1,B1)
        
        \tkzLabelSegments[left=-1pt](C2,B2 C2,A2){$R$}
        \tkzLabelSegments[left=-2pt](C1,B1 C1,A1){$r$}
        \tkzLabelSegment[above=-1.5pt](C1,C2){$d$}
        \tkzLabelSegment[above=-1.5pt](C1,X){$x$}
        
        \tkzMarkRightAngles[size=0.15](C2,A2,X X,B2,C2 C1,A1,X X,B1,C1)
        \tkzDrawPoints(C1, C2, A1, A2, B1, B2, X)
    \end{tikzpicture}
    \caption{Тень от сферического объекта при сферическом источнике}
    \label{pic:shadow-length}
\end{figure}

Пусть $R$ и $r$~--- радиусы источника и ширмы соответственно, а~$d$~--- расстояние между их центрами. Тогда из подобия треугольников
\begin{equation*}
    \frac{R}{d + x} = \frac{r}{x},
\end{equation*}
откуда
\begin{equation}
    x = \frac{r d}{R - r}.
\end{equation}
Так, например, длина тени Земли~--- области откуда не видно Солнца, составляет около $1.4 \times 10^{6}$~км.

Найдем теперь выражение для размера тени на поверхности~--- области поверхности, пересекающей тень, сферического объекта радиуса~$R$, находящегося на расстоянии  $d_1$ от сферического источника света радиуса $R_0$ и расстоянии $d_2$ от сферической ширмы радиуса $r$ так, что центры всех трёх объектов лежат на одной прямой, \lookPicRef{pic:shadow-size-on-surface}.

\begin{figure}[h!]
    \centering
    \begin{tikzpicture}
        \tkzDefPoint(0, 0){X}               % shadow's top
        \tkzDefPoint(-5,0){C1}              % sun's center
        \tkzDefShiftPoint[C1](0.7,0){R1}    % sun's radius
        \tkzDefPoint(-1.3,0){C3}            % earth's center
        \tkzDefShiftPoint[C3](-0.9,0){R3}   % earth's radius
        
        \def\k{1.7}
        \tkzDefPointBy[homothety=center X  ratio \k](C1) 
            \tkzGetPoint{C2} % moon's center
        \tkzDefPointBy[homothety=center X  ratio \k](R1) 
            \tkzGetPoint{R2} % moon's radius
        
        \tkzDefLine[tangent from = X](C1,R1) \tkzGetPoints{A1}{B1}
        \tkzDefLine[tangent from = X](C2,R2) \tkzGetPoints{A2}{B2}
        
        \tkzInterLC(X,B1)(C3,R3) \tkzGetPoints{x}{H1}
        \tkzInterLC(X,A1)(C3,R3) \tkzGetPoints{H2}{x}
        
        %%% draw
        
        \tkzDrawPolygon[fill=gray!40,draw=none](X,A1,B1)
        \tkzDrawPolygon[fill=white,draw=none](X,H1,H2)
        
        \tkzDrawCircles[fill=white, thick, draw=black](C1,R1 C2,R2 C3,R3)
        \tkzDrawSegments(H2,A2 H1,B2 R3,C2 C2,A2 C2,B2 C1,A1 C1,B1)
        \tkzDrawSegments[dashed](H2,X H1,X R3,X)
        
        \begin{scope}[
            dim style/.style={black, latex-latex, opacity=1},
            dim fence style/.style={black, opacity=1}
        ]
            \tkzDrawSegment[opacity=0, dim={$R$, -1cm, above=2pt}](C3,R3)
            \tkzDrawSegment[opacity=0, dim={$d_2$, -1.4cm, above=2pt}](C3,C1)
            \tkzDrawSegment[opacity=0, dim={$d_1$, -1.8cm, above=2pt}](C3,C2)
            \tkzDrawSegment[opacity=0, dim={$h$, 1cm, below=2pt}](X,R3)
            \tkzDrawSegment[opacity=0, dim={$x$, 1.5cm, above=2pt}](X,C1)
        \end{scope}
        
        \tkzMarkRightAngles[size=0.15](C2,A2,X X,B2,C2 C1,A1,X X,B1,C1)
        \tkzDrawPoints(C1, C2, A1, A2, B1, B2, X, C3, R3, H1, H2)
        
        %%% label
        
        \tkzLabelSegments[right=-1pt](C2,B2 C2,A2){$R_0$}
        \tkzLabelSegments[right=-2pt](C1,B1 C1,A1){$r$}
        \tkzLabelSegments[left=-2pt](R3,H1 R3,H2){$s$}
        
        %%% technical labeling
        
%        \tkzLabelPoints[font=\tiny](C1, C2, A1, A2, B1, B2, X, C3, R3, H1, H2)
    \end{tikzpicture}
    \caption{Схема формирования тени на поверхности объекта}
    \label{pic:shadow-size-on-surface}    
\end{figure}

Как было получено ранее, длина тени
\begin{equation*}
    x = \frac{r (d_1 - d_2)}{R_0 - r}.
\end{equation*}
Следовательно, высота конуса тени, находящегося за пересечением тени с поверхностью объекта, $h = x - d_2 + R$. Заметим, что при $x < d_2 - R$ на поверхности объекта тени вообще не будет. Пусть $x > d_2 - D$, тогда из подобия треугольников радиус тени на поверхности объекта
\begin{multline}
    s 
        \overset{r \ll x}{\simeq} \frac{r h}{x} 
        = \frac{r(x - d_2 + R)}{x} = \\
        = \frac{r (R_0 - r)}{r (d_1 - d_2)} \cdot \frac{r(d_1 - d_2) - (d_2 - R)(R_0 - r)}{R_0 - r} = \\
        = \frac{r (d_1 - R) - R_0 (d_2 - R)}{d_1 - d_2}.
\end{multline}

Среднее значение этой величины для системы Солнце~-- Земля~-- Луна составляет около 200~км, максимальное~--- около 215~км. При нецентральном затмении максимальный диаметр тени Луны на поверхности Земли может достигать 270~км. Это даёт оценку на продолжительность затмения, равную 7.5 минутам. Большинство полных затмений длятся 2\,--\,4~минуты.

\begin{figure}[h!]
	\centering
	\vspace{-.5pc}
	\begin{tikzpicture}  
        \def\e{0}
        \def\m{-1.6}
        \def\s{-7.2}
        
        \def\earthR{0.7}
        \def\moonR{0.18}
        \def\sunR{1}
        
        \def\gap{0.2}
        
        \tkzInit[
            xmax=\e + \earthR + \gap,
            xmin=\s - \sunR - \gap,
            ymin=-\sunR - \gap,
            ymax=\sunR + \gap
        ]
        \tkzClip
        
        \tkzDefPoint(\e,0){E}
        \tkzDefPoint(\m,0){M}
        \tkzDefPoint(\s,0){S}
        
        \tkzDefShiftPoint[S](0,\sunR){S'}
        \tkzDefShiftPoint[M](0,\moonR){M'}
        \tkzDefShiftPoint[E](0,\earthR){E'}
        
        \def\shadeCornerCoef{\sunR / (\sunR - \moonR)}
        \tkzDefPointBy[homothety=center S ratio \shadeCornerCoef](M)
        \tkzGetPoint{SC}
        
        \def\halfShadowCornerCoef{\sunR / (\sunR + \moonR)}
        \tkzDefPointBy[homothety=center S ratio \halfShadowCornerCoef](M)
        \tkzGetPoint{HSC}
        
        \tkzDefLine[tangent from = SC](S,S')  \tkzGetPoints{S1}{S2}
        \tkzDefLine[tangent from = SC](M,M')  \tkzGetPoints{M1}{M2}
        \tkzDefLine[tangent from = HSC](S,S')  \tkzGetPoints{HS1}{HS2}
        \tkzDefLine[tangent from = HSC](M,M')  \tkzGetPoints{HM1}{HM2}
        
        \tkzInterLC(SC,S1)(E,E') \tkzGetSecondPoint{E1}
        \tkzInterLC(SC,S2)(E,E') \tkzGetFirstPoint{E2}
        
        \tkzGetVectxy(HSC,M){hs}
        \def\halfShadowCoef{(\e - \m + \hsx) / \hsx }
        \tkzDefPointBy[homothety=center HSC ratio \halfShadowCoef](HM1)
        \tkzGetPoint{HE1}
        \tkzDefPointBy[homothety=center HSC ratio \halfShadowCoef](HM2)
        \tkzGetPoint{HE2}
        
        \tkzDrawSector[fill=gray!30,gray!30](HSC,HE2)(HE1)
        \tkzDrawSector[fill=gray!70](SC,M2)(M1)
        \tkzDrawSector[fill=white](HSC,HM2)(HM1)
        
        \tkzDrawCircles[dashed, line width=.4pt](S,E E,M) 

        \tkzDrawCircles[black, line width=.4pt, fill=white](S,S' M,M')
        \tkzDrawSegments(SC,S1 SC,S2 HS1,HE1 HS2,HE2)
        
        \tkzDrawCircles[black, line width=.4pt, fill=white, fill opacity=1](E,E')
        
        \tkzLabelPoint[inner sep=5mm](S){\tikz{\sun(S)}}
        \tkzLabelPoint(E){\tikz{\earth(E)}}
        \tkzLabelPoint(M){$\rightmoon$}
    \end{tikzpicture}
	\caption{Полное солнечное затмение со стороны северного полюса эклиптики}
	\label{fig:eclipses-full-solar-eslipse}
\end{figure}
При \term[кольцеобразное солнечное затмение]{кольцеобразном солнечном затмении} Луна так расположена относительно Земли, что конус её тени не достаёт до поверхности планеты, и вокруг Луны можно наблюдать яркое кольцо незакрытой части солнечного диска.

\begin{figure}[h!]
	\centering
	\begin{tikzpicture}      
        \def\e{0}
        \def\m{-2.2}
        \def\s{-7.2}
        
        \def\earthR{0.7}
        \def\moonR{0.18}
        \def\sunR{1}
        
        \def\gap{0.2}
        
        \tkzInit[
            xmax=\e + \earthR + \gap,
            xmin=\s - \sunR - \gap,
            ymin=-\sunR - \gap,
            ymax=\sunR + \gap
        ]
        \tkzClip
        
        \tkzDefPoint(\e,0){E}
        \tkzDefPoint(\m,0){M}
        \tkzDefPoint(\s,0){S}
        
        \tkzDefShiftPoint[S](0,\sunR){S'}
        \tkzDefShiftPoint[M](0,\moonR){M'}
        \tkzDefShiftPoint[E](0,\earthR){E'}
        
        \def\shadeCornerCoef{\sunR / (\sunR - \moonR)}
        \tkzDefPointBy[homothety=center S ratio \shadeCornerCoef](M)
        \tkzGetPoint{SC}
        
        \def\halfShadowCornerCoef{\sunR / (\sunR + \moonR)}
        \tkzDefPointBy[homothety=center S ratio \halfShadowCornerCoef](M)
        \tkzGetPoint{HSC}
        
        \tkzDefLine[tangent from = SC](S,S')  \tkzGetPoints{S1}{S2}
        \tkzDefLine[tangent from = SC](M,M')  \tkzGetPoints{M1}{M2}
        \tkzDefLine[tangent from = HSC](S,S')  \tkzGetPoints{HS1}{HS2}
        \tkzDefLine[tangent from = HSC](M,M')  \tkzGetPoints{HM1}{HM2}
        
        \tkzInterLC(SC,S1)(E,E') \tkzGetSecondPoint{E1}
        \tkzInterLC(SC,S2)(E,E') \tkzGetFirstPoint{E2}
        
        \tkzGetVectxy(HSC,M){hs}
        \def\halfShadowCoef{(\e - \m + \hsx) / \hsx }
        \tkzDefPointBy[homothety=center HSC ratio \halfShadowCoef](HM1)
        \tkzGetPoint{HE1}
        \tkzDefPointBy[homothety=center HSC ratio \halfShadowCoef](HM2)
        \tkzGetPoint{HE2}
        
        \tkzDefPointBy[homothety=center SC ratio -1](M1) \tkzGetPoint{SC1}
        \tkzDefPointBy[homothety=center SC ratio -1](M2) \tkzGetPoint{SC2}
        
        \tkzDrawSector[fill=gray!30,gray!30](HSC,HE2)(HE1)
        \tkzDrawSector[fill=gray!70](SC,M2)(M1)
        \tkzDrawSector[fill=gray!50](SC,SC2)(SC1)
        \tkzDrawSector[fill=white](HSC,HM2)(HM1)

        \tkzDrawCircles[dashed, line width=.4pt](S,E E,M) 

        \tkzDrawCircles[black, line width=.4pt, fill=white](S,S' M,M')
        \tkzDrawSegments(SC,S1 SC,S2 HS1,HE1 HS2,HE2)
        
        \tkzDrawCircles[black, line width=.4pt, fill=white, fill opacity=1](E,E')
        
        \tkzLabelPoint[inner sep=5mm](S){\tikz{\sun(S)}}
        \tkzLabelPoint(E){\tikz{\earth(E)}}
        \tkzLabelPoint(M){$\rightmoon$}
    \end{tikzpicture}
	\caption{Кольцеобразное солнечное затмение со стороны северного полюса эклиптики}
	\label{fig:eclipses-circle-solar-eslipse}
\end{figure}
При особом расположении Луны и Земли возможны \term{гибридные} затмения, когда в разных пунктах Земли наблюдаются либо \imp{кольцеобразное}, либо \imp{полное} затмение. Причиной такого явления является шарообразность Земли.

\vspace{-1pc}
\begin{figure}[h!]
	\centering
	\begin{tikzpicture}
        \def\e{2.2}
        \def\m{0}
        \def\s{-7.2}
        
        \def\earthR{0.25}
        \def\moonR{0.7}
        \def\sunR{1}
        
        \def\gap{0.2}
        
        \tkzInit[
            xmax=\e + \earthR + \gap,
            xmin=\s - \sunR - \gap,
            ymin=-\sunR - \gap,
            ymax=\sunR + \gap
        ]
        \tkzClip
        
        \tkzDefPoint(\e,0){E}
        \tkzDefPoint(\m,0){M}
        \tkzDefPoint(\s,0){S}
        
        \tkzDefShiftPoint[S](0,\sunR){S'}
        \tkzDefShiftPoint[M](0,\moonR){M'}
        \tkzDefShiftPoint[E](0,\earthR){E'}
        
        \def\shadeCornerCoef{\sunR / (\sunR - \moonR)}
        \tkzDefPointBy[homothety=center S ratio \shadeCornerCoef](M)
        \tkzGetPoint{SC}
        
        \def\halfShadowCornerCoef{\sunR / (\sunR + \moonR)}
        \tkzDefPointBy[homothety=center S ratio \halfShadowCornerCoef](M)
        \tkzGetPoint{HSC}
        
        \tkzDefLine[tangent from = SC](S,S')  \tkzGetPoints{S1}{S2}
        \tkzDefLine[tangent from = SC](M,M')  \tkzGetPoints{M1}{M2}
        \tkzDefLine[tangent from = HSC](S,S')  \tkzGetPoints{HS1}{HS2}
        \tkzDefLine[tangent from = HSC](M,M')  \tkzGetPoints{HM1}{HM2}
        
        \tkzGetVectxy(HSC,M){hs}
        \def\halfShadowCoef{1 + (\e - \m + \hsx) / \hsx }
        \tkzDefPointBy[homothety=center HSC ratio \halfShadowCoef](HM1)
        \tkzGetPoint{HE1}
        \tkzDefPointBy[homothety=center HSC ratio \halfShadowCoef](HM2)
        \tkzGetPoint{HE2}
        
        \tkzDrawSector[fill=gray!30,gray!30](HSC,HE2)(HE1)
        \tkzDrawSector[fill=gray!70](SC,M2)(M1)
        \tkzDrawSector[fill=white](HSC,HM2)(HM1)
        
        \tkzDrawCircles[dashed, line width=.4pt](S,M M,E)

        \tkzDrawCircles[black, line width=.4pt, fill=white](S,S' M,M')
        \tkzDrawSegments(SC,S1 SC,S2 HS1,HE1 HS2,HE2)
        
        \tkzDrawCircles[black, line width=.4pt, fill=white, fill opacity=1](E,E')
        
        \tkzLabelPoint[inner sep=5mm](S){\tikz{\sun(S)}}
        \tkzLabelPoint(M){\tikz{\earth(E)}}
        \tkzLabelPoint(E){$\rightmoon$}
    \end{tikzpicture}
	\caption{Схема лунного затмения со стороны северного полюса эклиптики}
	\label{fig:moon-eclipse-scheme}
\end{figure}
\term{Лунное затмение}, в отличие от солнечного, видно со всего ночного полушария Земли. Диаметр земной тени на расстоянии Луны превышает размер последней примерно в 2.5\,--\,3 раза. Бывают \term[частное затмение]{частные}, когда лишь часть Луны попадает в земную тень, \term[полное затмение]{полные}~--- Луна полностью погружается в тень Земли, и \term[полутеневое затмение]{полутеневые}~--- Луна проходит через полутень Земли, не затрагивая конус тени.

\term{Синодический месяц}~--- промежуток времени между одинаковыми фазами Луны, равен 29.53 суток.

\term{Драконический месяц}~--- промежуток времени между двумя последовательными прохождениями Луны через один и тот же узел орбиты,~--- 27.21 суток.

\term{Сарос}~--- промежуток  времени, по прошествии которого солнечные и лунные затмения повторяются в прежнем порядке. Происходит это из-за того, что каждый сарос Луна, орбита Луны и Солнце возвращаются в прежнее положение относительно далёких звёзд. Сарос длится ровно 242 драконических месяца, или 223 синодических месяца, или 18 лет 11 дней 8 часов.

\begin{wrapfigure}[8]{r}{.42\tw}
    \centering
    \vspace{-1pc}
    \begin{tikzpicture}
        \tkzDefPoint(0,0){C1}
        \tkzDefPoint(-0.6,0.6){C2}

        \def\R{0.7}
        \def\r{0.6}

        \tkzDefShiftPoint[C2](\r,0){R2}
        \tkzDrawCircle[semithick, draw=black, fill=white](C2,R2)

        \tkzDefShiftPoint[C1](\R,0){R1}
        \tkzDrawCircle[semithick, draw=black, fill=black!30](C1,R1)

        \tkzInterCC(C1,R1)(C2,R2) \tkzGetPoints{I1}{I2}
        \tkzInterLC(C1,C2)(C1,R1) \tkzGetPoints{x}{L1}
        \tkzInterLC(C1,C2)(C2,R2) \tkzGetPoints{L2}{x}

        \tkzDrawArc[semithick, dashed](C2,I1)(I2)

        \tkzDrawSegment(C1,C2)
        \tkzDrawSegment[latex-latex](L1,L2)

        \tkzDefPointBy[homothety=center C2 ratio -1](R2) \tkzGetPoint{R2'}

        \tkzDrawSegment[
        dim style/.append style={opacity=1},
        dim fence style/.style={opacity=1},
        dim={$D$, \fpeval{\r + 0.1} cm, above=2pt},
        opacity=0
        ](R2',R2)

        \tkzLabelSegment[above right=-2pt](L1,L2){$x$}

        \tkzDrawPoints(C1, C2)
    \end{tikzpicture}
    \hfill
    \begin{tikzpicture}
        \tkzDefPoint(0,0){C1}
        \tkzDefPoint(-0.2,-0.2){C2}

        \def\R{1.3}
        \def\r{0.6}

        \tkzDefShiftPoint[C1](\R,0){R1}
        \tkzDrawCircle[semithick, draw=black, fill=black!30](C1,R1)

        \tkzDefShiftPoint[C2](\r,0){R2}
        \tkzDrawCircle[semithick, draw=black, dashed](C2,R2)

        \tkzInterLC(C1,C2)(C1,R1) \tkzGetPoints{L1}{L2}
        \tkzInterLC(C1,C2)(C2,R2) \tkzGetPoints{I1}{I2}

        \tkzDefPointBy[homothety=center C2 ratio -1](R2) \tkzGetPoint{R2'}

        \tkzDrawSegment(L1,L2)
        \tkzDrawSegments[latex-latex](L1,I1 L2,I2)

        \tkzDrawSegment[
            dim style/.append style={opacity=1},
            dim fence style/.style={opacity=1},
            dim={$D$, \fpeval{\r + 0.1} cm, above=2pt, fill=none},
            opacity=0
        ](R2',R2)

        \tkzLabelSegment[below right=-4pt](L1,I1){$d_1$}
        \tkzLabelSegment[below right=-4pt](L2,I2){$d_2$}

        \tkzDrawPoints(C1, C2)
    \end{tikzpicture}
	\caption{Частное и полное затмение}
	\label{fig:part-eclipses-scheme}
\end{wrapfigure}
Важной характеристикой любого затмения является его \term{фаза}~--- для \imp{частных} и \imp{кольцеобразных} затмений: отношение закрытой части $x$ диаметра\footnote{Здесь имеется в виду \imp{угловой} диаметр} затмеваемого тела, проходящего через центр затмевающего тела, ко всему диаметру затмеваемого тела $D$; для \imp{полного}: единица плюс отношение расстояния\footnote{Расстояние между окружностями $l_1$ и $l_2$~--- это $\min |L_1L_2|$ по всем $L_1 \in l_1$ и $L_2 \in l_2$.} между краями дисков затмеваемого и затмевающего тел к диаметру затмеваемого тела $D$.
\begin{equation}
	\Phi_{\text{част}} = \frac{x}{D} < 1, \quad \quad \quad \Phi_{\text{полн}} =  1 + \frac{\min\{d_1, d_2\}}{D} > 1.
\end{equation}
Иногда вводят такое понятие, как \term{площадная фаза затмения}, т.\,е. отношение площади закрытой части диска затмеваемого тела к полной площади его диска. Чаще всего  площадную фазу используют применительно к двойным звёздам, когда считают падение блеска при затмении одной звезды другой.
